#!/bin/sh

#
# makeconfigure - a simple shell script to determine
#                 the configuration dependent parts
#                 of the rts.
#
#                 currently this only consists of linking
#
#                 this utility creates "configure.h"



#
# remove the old configuration file and create new empty ones
#

function Initialize () {
   /bin/rm -f $DESTINATION
   touch $DESTINATION
}


#
# create configuration constant
#

function EmitConst () {
   if [ "$2" = "TRUE" ] ; then
      echo "#define  " $1 "   /* automatically generated */" >> $DESTINATION
   else
      echo "#undef   " $1 "   /* automatically generated */" >> $DESTINATION
   fi
   echo "" >> $DESTINATION
}


#
# ModulePrologue - write the start of the configuration file.
#

function ModulePrologue () {
   cat >> $DESTINATION << EOF

/*
 * Title      : configure.h
EOF
   echo " *              DO NOT EDIT AS THIS IS AUTOMATICALLY GENERATED BY $ExecName" >> $DESTINATION
   echo " *" >> $DESTINATION
   echo " * Generated  :" `date` >> $DESTINATION
   cat >> $DESTINATION << EOF
 */

#if !defined(TRUE)
#    define TRUE  (1==1)
#endif

#if !defined(FALSE)
#    define FALSE (1==0)
#endif

EOF
}


#
# UseUnderscoreForC - find out whether gcc uses underscores.
#

function UseUnderscoreForC () {
   cat >> $DESTINATION << EOF
/*
 * UseUnderscoreForC - if true then the C compiler uses _ in front of
 *                     all declarations.
 */

EOF
   echo -n "does cc use an underscore prefix..."
   /bin/rm -f testus.c
   cat > testus.c << EOF
   main () {}
EOF
   cc -c testus.c
   if nm --extern-only testus.o | grep _main > /dev/null
   then
      EmitConst UseUnderscoreForC TRUE
      echo "yes"
   else
      EmitConst UseUnderscoreForC FALSE
      echo "no"
   fi
   /bin/rm -f testus.[co]
}


ExecName=$0
DESTINATION=configure.h
Initialize
ModulePrologue
UseUnderscoreForC
